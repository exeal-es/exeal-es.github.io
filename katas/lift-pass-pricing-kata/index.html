<!doctype html><html lang=es><head><script>(function(t,s,o,e,a){t[e]=t[e]||[],t[e].push({'gtm.start':(new Date).getTime(),event:"gtm.js"});var i=s.getElementsByTagName(o)[0],n=s.createElement(o),r=e!="dataLayer"?"&l="+e:'';n.async=!0,n.src="https://www.googletagmanager.com/gtm.js?id="+a+r,i.parentNode.insertBefore(n,i)})(window,document,"script","dataLayer","GTM-TQGN65PV")</script><meta charset=utf-8><title>Lift Pass Pricing Kata | Exeal</title><meta name=description content="Ejercicio para practicar cómo refactorizar una aplicación real con una base de datos."><meta name=author content="Exeal"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:title" content="Lift Pass Pricing Kata"><meta property="og:description" content="Ejercicio para practicar cómo refactorizar una aplicación real con una base de datos."><meta property="og:type" content="article"><meta property="og:url" content="https://www.exeal.com/katas/lift-pass-pricing-kata/"><meta property="og:image" content="https://www.exeal.com/assets/img/blog/posts/mountain-snow.jpg"><meta property="article:section" content="katas"><meta property="article:published_time" content="2024-02-23T00:00:00+00:00"><meta property="article:modified_time" content="2024-02-23T00:00:00+00:00"><meta itemprop=name content="Lift Pass Pricing Kata"><meta itemprop=description content="Ejercicio para practicar cómo refactorizar una aplicación real con una base de datos."><meta itemprop=datePublished content="2024-02-23T00:00:00+00:00"><meta itemprop=dateModified content="2024-02-23T00:00:00+00:00"><meta itemprop=wordCount content="529"><meta itemprop=image content="https://www.exeal.com/assets/img/blog/posts/mountain-snow.jpg"><meta itemprop=keywords content="refactoring,experienced,arquitectura,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.exeal.com/assets/img/blog/posts/mountain-snow.jpg"><meta name=twitter:title content="Lift Pass Pricing Kata"><meta name=twitter:description content="Ejercicio para practicar cómo refactorizar una aplicación real con una base de datos."><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css integrity=sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm crossorigin=anonymous><link rel=stylesheet href=https://www.exeal.com/scss/main.css><link rel=icon type=image/png href=/assets/img/favicon.png><link rel=apple-touch-icon href=/assets/img/apple-touch-icon.png><script type=text/javascript id=hs-script-loader async defer src=//js.hs-scripts.com/8231847.js></script>
<link rel=stylesheet type=text/css href=https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css><meta name=facebook-domain-verification content="xwbugjbpmp2jwy1y6mzdhe6ga267uz"><script>!function(t,o,i,a,e,n,s){if(t.fbq)return;e=t.fbq=function(){e.callMethod?e.callMethod.apply(e,arguments):e.queue.push(arguments)},t._fbq||(t._fbq=e),e.push=e,e.loaded=!0,e.version="2.0",e.queue=[],n=o.createElement(i),n.async=!0,n.src=a,s=o.getElementsByTagName(i)[0],s.parentNode.insertBefore(n,s)}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js"),fbq("init","417415780749470"),fbq("track","PageView")</script><noscript><img height=1 width=1 style=display:none src="https://www.facebook.com/tr?id=417415780749470&ev=PageView&noscript=1"></noscript><script>(function(e,n,o,i,s,t){e.hj=e.hj||function(){(e.hj.q=e.hj.q||[]).push(arguments)},e._hjSettings={hjid:5031744,hjsv:6},s=n.getElementsByTagName("head")[0],t=n.createElement("script"),t.async=1,t.src=o+e._hjSettings.hjid+i+e._hjSettings.hjsv,s.appendChild(t)})(window,document,"https://static.hotjar.com/c/hotjar-",".js?sv=")</script><link rel=stylesheet href=https://www.exeal.com/scss/blog.css><link rel=stylesheet href=https://www.exeal.com/scss/hero.css></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TQGN65PV" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><nav class="navbar navbar-light navbar-expand-lg navbar-shrink"><div class=container><div class="d-flex flex-row"><a href=/ class=navbar-brand><img src=/assets/img/logo-exeal-header-black.svg alt=Exeal></a>
<a href=/katas/ class=navbar-brand><img src=/assets/img/katas/logo-katas.svg alt=Katas></a></div><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarTogglerDemo01 aria-controls=navbarTogglerDemo01 aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarTogglerDemo01><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link nav-button" href=/lista-de-correo/>Suscríbete a la newsletter</a></li></ul></div></div></nav><header class="hero hero-bg-img" style=background-image:url(/assets/img/blog/posts/mountain-snow.jpg)><div class="hero-bg-img-mask bg-mask"><div class="container h-100"><div class="row h-100 align-items-center"><div class="col-12 text-center"><ul class="tags tags-light"><li><a href=https://www.exeal.com/tags/refactoring/>#refactoring</a></li><li><a href=https://www.exeal.com/tags/experienced/>#experienced</a></li><li><a href=https://www.exeal.com/tags/arquitectura/>#arquitectura</a></li></ul><h1><span class=underline>Lift Pass Pricing Kata</span></h1><p><a data-scroll=sect-body href=#><img class=arrow-down src=/assets/img/arrow-down-secondary.svg></a></p></div></div></div></div></header><section id=sect-body><div class=container><article><h2 id=tu-tarea>Tu tarea</h2><p>Esta aplicación resuelve el problema de calcular el precio de los <em>forfaits</em>, es decir, los pases para acceder a esquiar. Existe una lógica intrincada vinculada al tipo de <em>forfait</em> que deseas, tu edad y la fecha específica en la que te gustaría esquiar.</p><p>Se pide implementar una nueva funcionalidad: poder obtener el precio de varios <em>forfaits</em>, no solo uno.</p><p>Actualmente, el precio de un solo <em>forfait</em> está implementado; desafortunadamente, el código tal como está diseñado no es reutilizable. Podrías implementar algunos tests de alto nivel para realizar una refactorización preparatoria de modo que la nueva funcionalidad requiera un esfuerzo mínimo para implementarse.</p><p>Esta kata modela un problema común: <strong>código que no tiene sentido testear unitariamente debido a un mal diseño</strong>.</p><h2 id=cuándo-he-terminado>¿Cuándo he terminado?</h2><p>Hay algunos pasos, podrías realizar cualquiera de ellos.</p><ol><li>Cubrir con tests de alto nivel.</li><li>Refactorizar el código para habilitar la implementación de tests unitarios y reutilización para la nueva funcionalidad.</li><li>Reducir la cantidad de tests de alto nivel.</li><li>Implementar la nueva característica utilizando tests unitarios y 1 o 2 tests de alto nivel.</li></ol><h2 id=instalación>Instalación</h2><p>Descarga el código inicial aquí, y elige el lenguaje en el que desees resolver la kata: <a href=https://github.com/martinsson/Refactoring-Kata-Lift-Pass-Pricing>https://github.com/martinsson/Refactoring-Kata-Lift-Pass-Pricing</a></p><p>Configura una base de datos MySQL en <code>localhost:3306</code> con el usuario <code>root</code> y la contraseña <code>mysql</code>. Si tienes Docker instalado, lo más fácil es usar este script, que inicializará una MariaDB.</p><pre tabindex=0><code>./runLocalDatabase.sh
</code></pre><p>Inyecta los datos con</p><pre tabindex=0><code>mysql -u root -p mysql &lt; ./database/initDatabase.sql
</code></pre><p>Luego dirígete al lenguaje de tu elección y sigue el Readme que está allí. Algunos de los lenguajes tienen una prueba fallida que podrías terminar de escribir.</p><h2 id=cómo-resolverla>Cómo resolverla</h2><p>Existe una buena posibilidad de que puedas encontrar un diseño que sea más fácil de probar, más rápido de trabajar y que resuelva el problema con la cantidad mínima de código. Un diseño así sería desacoplar la mayor parte de la lógica del framework HTTP/REST y de las especificidades de SQL. A esto a veces se le llama arquitectura hexagonal y facilita respetar la Pirámide de Tests, lo cual actualmente no es posible, ya que solo puede haber pruebas de nivel superior.</p><p>El flujo de trabajo típico sería:</p><ol><li>Cubrir todo desde la capa HTTP, usando una base de datos real.</li><li>Separar la extracción de datos de la solicitud y el envío de la respuesta de la lógica.</li><li>Extraer un método con la lógica pura, mover ese método a un objeto (por ejemplo, <code>PricingLogic</code>).</li><li>Ahora extraer las cosas de SQL de PricingLogic, primero a algún método con una firma que no tenga nada que ver con SQL, luego mover estos métodos a una nueva clase (por ejemplo, <code>PricingDao</code>).</li><li>Debería haber ~3/4 elementos, la capa HTTP debería tener <code>PricingLogic</code> como una dependencia inyectada y <code>PricingLogic</code> debería tener <code>PricingDao</code> como una dependencia inyectada.</li><li>Mover la mayor parte de las pruebas de alto nivel hacia abajo en <code>PricingLogic</code> usando un dao falso, escribir algunas pruebas de integración enfocadas para <code>PricingDao</code> usando una base de datos real, deberían ser solo unas pocas.</li><li>Ahora la capa HTTP y la integración de las partes pueden ser probadas con muy pocas (una o dos) pruebas de alto nivel.</li></ol><h2 id=recursos>Recursos</h2><ul><li><a href="https://github.com/martinsson/Refactoring-Kata-Lift-Pass-Pricing?tab=readme-ov-file">Repositorio de Github original</a></li><li><a href="https://www.youtube.com/watch?v=-gSyD60WAvc&ab_channel=JohanMartinsson">Explicación del ejercicio (Johan Martinsson, inglés)</a></li></ul></article></div><div class=container><div class="row h-100 align-items-center"><div class="col-12 text-center"><ul class="tags tags-dark"><li><a href=https://www.exeal.com/tags/refactoring/>#refactoring</a></li><li><a href=https://www.exeal.com/tags/experienced/>#experienced</a></li><li><a href=https://www.exeal.com/tags/arquitectura/>#arquitectura</a></li></ul><div class=addthis_inline_share_toolbox></div></div></div></div></section><footer class=black><div class=container><div class="row align-items-center"><div class="col-lg-6 text-lg-left"><a href=/><img src=/assets/img/logo-exeal-footer.svg alt=Exeal></a><p><a href=/equipo/>Equipo</a> |
<a href=/jobs/extreme-programming-coach/>Empleo</a> |
<a href=/legal/legal-notice/>Aviso legal</a> |
<a href=/legal/cookie-policy/>Política de cookies</a> |
<a href=/legal/privacy-policy/>Política de privacidad</a></p></div><div class="col-lg-6 social-media"><ul class="list-inline text-lg-right mt-3 mt-lg-0"><li class=list-inline-item><a target=_blank href=https://twitter.com/exeal><img src=/assets/img/social/twitter.svg></a></li><li class=list-inline-item><a target=_blank href=https://www.linkedin.com/company/exeal/><img src=/assets/img/social/linkedin.svg></a></li><li class=list-inline-item><a target=_blank href=https://www.youtube.com/channel/UCxVspi-mashFr1RPGxSxEPA><img src=/assets/img/social/youtube.svg></a></li><li class=list-inline-item><a target=_blank href=https://github.com/exeal-es><img src=/assets/img/social/github.svg></a></li><li class=list-inline-item><a target=_blank href=mailto:hola@exeal.com><img src=/assets/img/social/email.svg></a></li></ul></div></div></div></footer><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js integrity=sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q crossorigin=anonymous></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js integrity=sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl crossorigin=anonymous></script>
<script src=/assets/js/scroll.js></script>
<script src=/assets/js/redirect.js></script>
<script src=/assets/js/console.js></script>
<script>function loadScript(t){var n=document.getElementsByTagName("head")[0],e=document.createElement("script");e.type="text/javascript",e.src="https://tracker.metricool.com/resources/be.js",e.onreadystatechange=t,e.onload=t,n.appendChild(e)}loadScript(function(){beTracker.t({hash:"45d30dfb71957d625ad900e4772a2d6a"})})</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f2bf2edad69c454"></script></body></html>